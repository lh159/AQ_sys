# AQ-用户标签系统 - 文件上传分析版本

一个基于大语言模型的智能用户画像分析系统，专门用于医疗健康领域的对话文件批量分析和标签提取。

## 🎯 系统特点

- **文件批量分析**: 支持上传对话文件(.txt, .json, .md)进行批量分析
- **智能标签提取**: 基于LLM自动从对话内容中提取多维度标签
- **动态画像构建**: 基于对话内容构建完整的用户画像
- **多维度分析**: 涵盖用户核心画像、产品使用偏好、意图分析、商业价值等四大维度
- **可视化展示**: 直观展示用户画像成熟度和各维度标签分布
- **标签溯源**: 记录每个标签的证据来源和变化历史

## 🏗️ 系统架构

```
AQ-用户标签系统/
├── app/                    # 核心逻辑层
│   ├── core/              
│   │   ├── models.py      # 数据模型定义
│   │   ├── tag_extractor.py # 标签提取器
│   │   └── tag_manager.py   # 标签管理器
├── web/                   # Web层
│   ├── templates/
│   │   └── index.html     # 前端界面
│   └── app.py            # Flask应用
├── user_data/            # 用户数据存储
├── tag_schema.json       # 标签体系定义
├── config.yaml          # 系统配置
├── requirements.txt      # Python依赖
└── run_demo.py          # 启动脚本
```

## 🚀 快速开始

### 1. 环境准备

```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境 (Windows)
venv\Scripts\activate
# 激活虚拟环境 (macOS/Linux)
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置设置

编辑 `config.yaml` 文件，填入你的LLM API配置：

```yaml
llm:
  provider: "deepseek"
  model: "deepseek-chat"
  api_key: "你的API密钥"  # 请替换为真实的API Key
  base_url: "https://api.deepseek.com"
```

### 3. 启动系统

```bash
python run_demo.py
```

启动后在浏览器访问：`http://127.0.0.1:8080`

## 💡 使用方法

1. **上传文件**: 将包含对话内容的文件(.txt, .json, .md)拖拽到上传区域或点击选择文件
2. **文件解析**: 系统会自动解析文件内容，识别对话轮数和有效对话
3. **开始分析**: 点击"开始分析"按钮，系统会批量分析所有对话内容
4. **查看结果**: 分析完成后，在右侧用户画像区域查看提取的标签和用户画像
5. **重置会话**: 点击"重置会话"按钮可清除当前分析结果

## 📊 标签体系

系统包含四大标签维度：

### 1. 用户核心画像
- **年龄段**: 婴幼儿、儿童、青少年、青年、中年、老年
- **性别**: 男、女  
- **所在地区**: 一线城市、二线城市、三线及以下城市
- **健康角色**: 个人健康管理者、家庭健康决策者、慢性病患者等

### 2. 产品使用路径与偏好
- **核心功能偏好**: AI诊断依赖型、信息查询导向型、服务闭环驱动型等
- **交互方式偏好**: 语音交互型、文本交互型、图像识别型等

### 3. 用户意图与转化阶段  
- **具体意图分类**: 症状自我评估、专业报告解读、药品信息核对等
- **转化阶段**: 信息认知阶段、问题分析阶段、决策行动阶段等

### 4. 用户商业价值
- **价值等级**: 高价值用户、高潜力用户、高活跃用户等
- **付费敏感度**: 价格不敏感、价格敏感、纯免费用户

## 🔧 API接口

- `POST /api/upload_file` - 上传对话文件进行解析
- `POST /api/analyze_file` - 批量分析对话内容
- `GET /api/profile` - 获取当前用户画像
- `GET /api/timeline` - 获取标签变化时间线
- `GET /api/stats` - 获取系统统计信息
- `POST /api/reset_user` - 重置用户会话

## 📝 文件格式示例

**支持的文件格式**:

1. **文本文件 (.txt)**:
```
用户: 我最近总是失眠，想了解一下是什么原因，需要看医生吗？
助手: 失眠可能由多种原因引起...

用户: 我今年28岁，工作压力比较大
助手: 工作压力确实是导致失眠的常见原因...
```

2. **JSON文件 (.json)**:
```json
[
  {
    "user": "我最近总是失眠，想了解一下是什么原因，需要看医生吗？",
    "assistant": "失眠可能由多种原因引起..."
  },
  {
    "user": "我今年28岁，工作压力比较大",
    "assistant": "工作压力确实是导致失眠的常见原因..."
  }
]
```

**系统分析结果**:
- 提取年龄段: 青年 (confidence: 0.7)
- 提取意图: 症状自我评估 (confidence: 0.9)  
- 提取转化阶段: 问题分析阶段 (confidence: 0.8)
- 构建完整用户画像

## 🛠️ 技术栈

- **后端**: Python + Flask
- **LLM**: DeepSeek API / 兼容OpenAI API
- **数据存储**: 本地JSON文件
- **前端**: HTML + CSS + JavaScript
- **部署**: 本地开发服务器

## 📁 数据存储

用户数据存储在 `user_data/{user_id}/` 目录下：
- `user_tags.json` - 用户画像数据
- `tag_timeline.json` - 标签变化历史

## ⚠️ 注意事项

1. 确保API密钥配置正确
2. 首次运行会自动创建必要的目录
3. 用户数据采用会话隔离，不同用户数据互不影响
4. 系统支持标签的强化和时间衰减机制

## 🔮 扩展功能

- 支持导出用户画像报告
- 集成更多LLM服务商
- 增加批量用户数据分析
- 优化标签体系和算法
- 增加数据可视化图表

---

💡 **提示**: 这是一个演示系统，用于展示基于LLM的用户画像构建能力。在生产环境中使用时，建议进行安全性和性能优化。
