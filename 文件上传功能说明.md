# AQ智能体长文本对话分析功能

## 🎯 功能概述

AQ智能体现在支持通过上传长文本文件（txt、json、md格式）进行批量对话分析，自动提取用户标签并构建用户画像。

## 📁 支持的文件格式

### 1. TXT格式
支持多种对话分隔符：
```
用户：我的胃不舒服，想吐...
AI：根据您的症状，建议...

Q：孩子发烧了怎么办？
A：建议先进行物理降温...

Human：我想了解高血压
Assistant：高血压需要注意...
```

### 2. JSON格式
支持多种JSON结构：

**格式1 - conversations数组：**
```json
{
  "conversations": [
    {
      "user": "用户消息",
      "assistant": "AI回复",
      "timestamp": "2024-01-15T10:30:00Z"
    }
  ]
}
```

**格式2 - 直接数组：**
```json
[
  {
    "user": "用户消息",
    "assistant": "AI回复"
  }
]
```

**格式3 - OpenAI消息格式：**
```json
{
  "messages": [
    {"role": "user", "content": "用户消息"},
    {"role": "assistant", "content": "AI回复"}
  ]
}
```

### 3. Markdown格式
支持多种标记方式：

**标题分隔：**
```markdown
## 用户
我的健康问题...

## 助手
建议您...
```

**粗体标记：**
```markdown
**用户：** 我想咨询...
**助手：** 根据您的情况...
```

## 🚀 使用方法

### 1. 文件上传
1. 在AQ系统界面中，点击"📁 批量对话分析"展开上传区域
2. 拖拽文件到上传区域，或点击"点击选择文件"
3. 支持的文件类型：.txt、.json、.md
4. 文件大小限制：16MB

### 2. 文件解析
- 系统会自动解析文件内容
- 显示解析状态和对话数量统计
- 预览前3轮对话内容
- 验证对话质量（过滤空对话和过短对话）

### 3. 批量分析
1. 文件解析成功后，点击"开始分析"
2. 系统逐轮分析每个对话，提取用户标签
3. 实时显示分析进度
4. 自动更新用户画像

### 4. 分析结果
分析完成后显示：
- 总对话数量和成功处理数量
- 提取的标签总数和更新的标签数
- 用户画像成熟度变化
- 各类标签分布统计
- 平均每轮对话的标签数

## 📊 分析特色

### 智能标签提取
- **多维度分析**：年龄、性别、健康角色、意图等
- **上下文理解**：结合用户消息和AI回复进行全面分析
- **置信度评估**：每个标签都有置信度评分

### 画像渐进构建
- **标签权重机制**：重复出现的标签权重增加
- **时效性管理**：标签具有时间衰减特性
- **冲突处理**：自动处理互斥标签（如不同年龄段）

### 批量处理优化
- **分批处理**：避免API请求过于频繁
- **错误恢复**：单条对话失败不影响整体处理
- **进度反馈**：实时显示处理进度

## 💡 使用建议

### 文件准备
1. **格式规范**：确保对话格式清晰，用户和AI回复能够明确区分
2. **内容质量**：对话内容应该完整、有意义，避免过多无关信息
3. **编码格式**：文件应该使用UTF-8编码

### 分析效果
1. **对话数量**：建议每次上传10-100轮对话，获得较好的分析效果
2. **内容丰富性**：对话内容越丰富，提取的标签越全面
3. **连续性**：同一用户的多轮对话能够构建更准确的画像

## 🔧 技术特性

- **文件大小限制**：最大16MB
- **并发处理**：支持同时上传和分析
- **容错机制**：自动处理格式错误和解析失败
- **进度监控**：实时显示处理进度和状态
- **结果溯源**：保留每个标签的提取证据

## 📈 应用场景

1. **历史对话分析**：分析已有的客服对话记录
2. **用户研究**：批量分析用户反馈和需求
3. **健康咨询**：分析健康相关的对话数据
4. **产品优化**：了解用户画像特征，优化产品功能

---

💡 **提示**：首次使用建议先用小文件测试，熟悉功能后再处理大批量数据。如有问题，可以查看控制台输出获取详细的错误信息。
